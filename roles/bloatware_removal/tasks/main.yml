---
- name: Remove bloatware packages
  community.general.pacman:
    name: "{{ item }}"
    state: absent
  loop: "{{ bloatware_packages }}"
  when: bloatware_packages is defined and bloatware_packages | length > 0
  become: yes
  ignore_errors: yes
  register: bloatware_removal_result

- name: Show bloatware removal results
  debug:
    msg: "Package {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ bloatware_removal_result.results }}"
  when: bloatware_removal_result is defined

- name: Remove 1Password configuration files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ onepassword_config_files }}"
  when: onepassword_config_files is defined and onepassword_config_files | length > 0
  ignore_errors: yes
  register: onepassword_files_removal_result

- name: Show 1Password files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ onepassword_files_removal_result.results }}"
  when: onepassword_files_removal_result is defined

- name: Remove 1Password reference from Hyprland apps.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.local/share/omarchy/default/hypr/apps.conf"
    regexp: "^source.*1password\\.conf$"
    state: absent
  ignore_errors: yes
  register: onepassword_apps_conf_removal

- name: Show apps.conf update result
  debug:
    msg: "1Password reference in apps.conf - Status: {{ 'Removed' if onepassword_apps_conf_removal.changed else 'Not present' }}"
  when: onepassword_apps_conf_removal is defined

- name: Reload Hyprland configuration after 1Password removal
  ansible.builtin.command: hyprctl reload
  ignore_errors: yes
  when: onepassword_apps_conf_removal.changed
  register: hyprland_reload_result

- name: Show Hyprland reload result
  debug:
    msg: "Hyprland reload - Status: {{ 'Success' if hyprland_reload_result.rc == 0 else 'Failed' }}"
  when: hyprland_reload_result is defined and not hyprland_reload_result.skipped | default(false)

- name: Remove Basecamp web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ basecamp_webapp_files }}"
  when: basecamp_webapp_files is defined and basecamp_webapp_files | length > 0
  ignore_errors: yes
  register: basecamp_files_removal_result

- name: Show Basecamp files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ basecamp_files_removal_result.results }}"
  when: basecamp_files_removal_result is defined

- name: Remove Google Contacts web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ google_contacts_webapp_files }}"
  when: google_contacts_webapp_files is defined and google_contacts_webapp_files | length > 0
  ignore_errors: yes
  register: google_contacts_files_removal_result

- name: Show Google Contacts files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ google_contacts_files_removal_result.results }}"
  when: google_contacts_files_removal_result is defined

- name: Remove Google Messages web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ google_messages_webapp_files }}"
  when: google_messages_webapp_files is defined and google_messages_webapp_files | length > 0
  ignore_errors: yes
  register: google_messages_files_removal_result

- name: Show Google Messages files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ google_messages_files_removal_result.results }}"
  when: google_messages_files_removal_result is defined

- name: Remove Google Messages keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER ALT.*G.*Google Messages.*$"
    state: absent
  ignore_errors: yes
  register: google_messages_keybinding_removal

- name: Show Google Messages keybinding removal result
  debug:
    msg: "Google Messages keybinding - Status: {{ 'Removed' if google_messages_keybinding_removal.changed else 'Not present' }}"
  when: google_messages_keybinding_removal is defined

- name: Reload Hyprland configuration after Google Messages removal
  ansible.builtin.command: hyprctl reload
  ignore_errors: yes
  when: google_messages_keybinding_removal.changed
  register: google_messages_hyprland_reload

- name: Show Hyprland reload result after Google Messages removal
  debug:
    msg: "Hyprland reload - Status: {{ 'Success' if google_messages_hyprland_reload.rc == 0 else 'Failed' }}"
  when: google_messages_hyprland_reload is defined and not google_messages_hyprland_reload.skipped | default(false)

- name: Remove Google Photos web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ google_photos_webapp_files }}"
  when: google_photos_webapp_files is defined and google_photos_webapp_files | length > 0
  ignore_errors: yes
  register: google_photos_files_removal_result

- name: Show Google Photos files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ google_photos_files_removal_result.results }}"
  when: google_photos_files_removal_result is defined

- name: Remove HEY web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ hey_webapp_files }}"
  when: hey_webapp_files is defined and hey_webapp_files | length > 0
  ignore_errors: yes
  register: hey_files_removal_result

- name: Show HEY files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ hey_files_removal_result.results }}"
  when: hey_files_removal_result is defined

- name: Remove HEY Calendar keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER.*C.*Calendar.*$"
    state: absent
  ignore_errors: yes
  register: hey_calendar_keybinding_removal

- name: Show HEY Calendar keybinding removal result
  debug:
    msg: "HEY Calendar keybinding - Status: {{ 'Removed' if hey_calendar_keybinding_removal.changed else 'Not present' }}"
  when: hey_calendar_keybinding_removal is defined

- name: Remove HEY Email keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER.*E.*Email.*$"
    state: absent
  ignore_errors: yes
  register: hey_email_keybinding_removal

- name: Show HEY Email keybinding removal result
  debug:
    msg: "HEY Email keybinding - Status: {{ 'Removed' if hey_email_keybinding_removal.changed else 'Not present' }}"
  when: hey_email_keybinding_removal is defined

- name: Remove Grok keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER SHIFT.*A.*Grok.*$"
    state: absent
  ignore_errors: yes
  register: grok_keybinding_removal

- name: Show Grok keybinding removal result
  debug:
    msg: "Grok keybinding - Status: {{ 'Removed' if grok_keybinding_removal.changed else 'Not present' }}"
  when: grok_keybinding_removal is defined

- name: Reload Hyprland configuration after HEY and Grok keybindings removal
  ansible.builtin.command: hyprctl reload
  ignore_errors: yes
  when: hey_calendar_keybinding_removal.changed or hey_email_keybinding_removal.changed or grok_keybinding_removal.changed
  register: hey_grok_hyprland_reload

- name: Show Hyprland reload result after HEY and Grok keybindings removal
  debug:
    msg: "Hyprland reload - Status: {{ 'Success' if hey_grok_hyprland_reload.rc == 0 else 'Failed' }}"
  when: hey_grok_hyprland_reload is defined and not hey_grok_hyprland_reload.skipped | default(false)

- name: Remove Signal configuration files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ signal_config_files }}"
  when: signal_config_files is defined and signal_config_files | length > 0
  ignore_errors: yes
  register: signal_files_removal_result

- name: Show Signal files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ signal_files_removal_result.results }}"
  when: signal_files_removal_result is defined

- name: Remove Signal keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER.*G.*Signal.*$"
    state: absent
  ignore_errors: yes
  register: signal_keybinding_removal

- name: Show Signal keybinding removal result
  debug:
    msg: "Signal keybinding - Status: {{ 'Removed' if signal_keybinding_removal.changed else 'Not present' }}"
  when: signal_keybinding_removal is defined

- name: Update WhatsApp keybinding to Super+G
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd = SUPER SHIFT, G, WhatsApp,.*$"
    line: "bindd = SUPER, G, WhatsApp, exec, omarchy-launch-or-focus-webapp WhatsApp \"https://web.whatsapp.com/\""
    state: present
  ignore_errors: yes
  register: whatsapp_keybinding_update

- name: Show WhatsApp keybinding update result
  debug:
    msg: "WhatsApp keybinding - Status: {{ 'Updated to Super+G' if whatsapp_keybinding_update.changed else 'Already correct or not present' }}"
  when: whatsapp_keybinding_update is defined

- name: Reload Hyprland configuration after Signal removal
  ansible.builtin.command: hyprctl reload
  ignore_errors: yes
  when: signal_keybinding_removal.changed or whatsapp_keybinding_update.changed
  register: signal_hyprland_reload

- name: Show Hyprland reload result after Signal removal
  debug:
    msg: "Hyprland reload - Status: {{ 'Success' if signal_hyprland_reload.rc == 0 else 'Failed' }}"
  when: signal_hyprland_reload is defined and not signal_hyprland_reload.skipped | default(false)

- name: Remove ChatGPT web app files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ chatgpt_webapp_files }}"
  when: chatgpt_webapp_files is defined and chatgpt_webapp_files | length > 0
  ignore_errors: yes
  register: chatgpt_files_removal_result

- name: Show ChatGPT files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ chatgpt_files_removal_result.results }}"
  when: chatgpt_files_removal_result is defined

- name: Remove ChatGPT keybinding from bindings.conf
  ansible.builtin.lineinfile:
    path: "{{ ansible_env.HOME }}/.config/hypr/bindings.conf"
    regexp: "^bindd.*SUPER.*A.*ChatGPT.*$"
    state: absent
  ignore_errors: yes
  register: chatgpt_keybinding_removal

- name: Show ChatGPT keybinding removal result
  debug:
    msg: "ChatGPT keybinding - Status: {{ 'Removed' if chatgpt_keybinding_removal.changed else 'Not present' }}"
  when: chatgpt_keybinding_removal is defined

- name: Reload Hyprland configuration after ChatGPT removal
  ansible.builtin.command: hyprctl reload
  ignore_errors: yes
  when: chatgpt_keybinding_removal.changed
  register: chatgpt_hyprland_reload

- name: Show Hyprland reload result after ChatGPT removal
  debug:
    msg: "Hyprland reload - Status: {{ 'Success' if chatgpt_hyprland_reload.rc == 0 else 'Failed' }}"
  when: chatgpt_hyprland_reload is defined and not chatgpt_hyprland_reload.skipped | default(false)

- name: Remove Typora configuration files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop: "{{ typora_config_files }}"
  when: typora_config_files is defined and typora_config_files | length > 0
  ignore_errors: yes
  register: typora_files_removal_result

- name: Show Typora files removal results
  debug:
    msg: "File {{ item.item }} - Status: {{ 'Removed' if item.changed else 'Not present or error' }}"
  loop: "{{ typora_files_removal_result.results }}"
  when: typora_files_removal_result is defined
